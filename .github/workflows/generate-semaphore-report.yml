name: Generate Semaphore Study Report

on:
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰

permissions:
  contents: write

jobs:
  create-semaphore-report:
    runs-on: ubuntu-latest
    env:
      # í•œê¸€ ì¸ì½”ë”© ì„¤ì •
      LANG: ko_KR.UTF-8
      LC_ALL: ko_KR.UTF-8
      TZ: 'Asia/Seoul'

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Date
        run: echo "TODAY=$(date +'%Y-%m-%d')" >> $GITHUB_ENV

      - name: Create Reports Directory
        run: mkdir -p reports

      - name: Generate Markdown Report
        shell: bash
        run: |
          FILE_NAME="reports/${TODAY}_ì„¸ë§ˆí¬ì–´_ì‹¬ì¸µë¶„ì„.md"
          
          # ë³´ê³ ì„œ ë‚´ìš© ì‘ì„±
          cat <<EOF > "$FILE_NAME"
          # ğŸš¦ ì„¸ë§ˆí¬ì–´(Semaphore) ì‹¬ì¸µ ë¶„ì„ ë° ê¸°ì¶œ ì˜ˆìƒ

          **ì‘ì„±ì¼:** ${TODAY}
          **ì£¼ì œ:** ìš´ì˜ì²´ì œ ë™ê¸°í™” ê¸°ë²• - ì„¸ë§ˆí¬ì–´

          ---

          ## 1. ì„¸ë§ˆí¬ì–´(Semaphore) í•µì‹¬ ì´ë¡ 

          ### 1.1 ì •ì˜
          ì„¸ë§ˆí¬ì–´ëŠ” **ì—ì¸ í—ˆë¥´ ë‹¤ìµìŠ¤íŠ¸ë¼(Edsger Dijkstra)**ê°€ ê³ ì•ˆí•œ ë™ê¸°í™” ë„êµ¬ë¡œ, ë©€í‹°í”„ë¡œê·¸ë˜ë° í™˜ê²½ì—ì„œ **ê³µìœ  ìì›(Shared Resource)**ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´í•˜ê¸° ìœ„í•œ ì •ìˆ˜í˜• ë³€ìˆ˜(S)ì…ë‹ˆë‹¤.

          ### 1.2 ë™ì‘ ì›ë¦¬ (P-V ì—°ì‚°)
          ì„¸ë§ˆí¬ì–´ëŠ” ì˜¤ì§ ë‹¤ìŒ ë‘ ê°€ì§€ ì›ìì (Atomic) ì—°ì‚°ì„ í†µí•´ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.

          * **P ì—°ì‚° (Wait/Down):** ìì› ìš”ì²­
              - \`S\`ë¥¼ 1 ê°ì†Œì‹œí‚µë‹ˆë‹¤.
              - ê²°ê³¼ê°€ 0ë³´ë‹¤ ì‘ìœ¼ë©´ í”„ë¡œì„¸ìŠ¤ëŠ” ìì›ì´ ìƒê¸¸ ë•Œê¹Œì§€ **ëŒ€ê¸°(Block)**í•©ë‹ˆë‹¤.
              \`\`\`c
              P(S):
                S = S - 1;
                if (S < 0) block();
              \`\`\`

          * **V ì—°ì‚° (Signal/Up):** ìì› ë°˜ë‚©
              - \`S\`ë¥¼ 1 ì¦ê°€ì‹œí‚µë‹ˆë‹¤.
              - ëŒ€ê¸° ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ê°€ ìˆë‹¤ë©´ í•˜ë‚˜ë¥¼ **ê¹¨ì›ë‹ˆë‹¤(Wake-up)**.
              \`\`\`c
              V(S):
                S = S + 1;
                if (S <= 0) wakeup(P);
              \`\`\`

          ### 1.3 ì„¸ë§ˆí¬ì–´ vs ë®¤í…ìŠ¤ (Mutex)
          | êµ¬ë¶„ | ì„¸ë§ˆí¬ì–´ (Semaphore) | ë®¤í…ìŠ¤ (Mutex) |
          |:---:|:---|:---|
          | **ì†Œìœ ê¶Œ** | ì—†ìŒ (ëˆ„êµ¬ë‚˜ í•´ì œ ê°€ëŠ¥) | ìˆìŒ (Lock ê±´ ìŠ¤ë ˆë“œë§Œ í•´ì œ ê°€ëŠ¥) |
          | **ê°’ì˜ ë²”ìœ„** | 0 ì´ìƒ (ì¹´ìš´íŒ… ê°€ëŠ¥) | 0 ë˜ëŠ” 1 (ì´ì§„) |
          | **ëª©ì ** | ìì› ê´€ë¦¬, ìˆœì„œ ì œì–´ | ìƒí˜¸ ë°°ì œ (Locking) |

          ---

          ## 2. ì •ë³´ë³´ì•ˆê¸°ì‚¬ ì˜ˆìƒ ë¬¸ì œ (í•„ê¸°/ì‹¤ê¸°)

          ### Q1. ë ˆì´ìŠ¤ ì»¨ë””ì…˜(Race Condition) ë°©ì–´
          **ë¬¸ì œ:** ê²€ì‚¬ ì‹œì (Check)ê³¼ ì‚¬ìš© ì‹œì (Use)ì˜ ë¶ˆì¼ì¹˜ë¡œ ë°œìƒí•˜ëŠ” TOCTOU ì·¨ì•½ì ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ê·¼ë³¸ì ì¸ ëŒ€ì±…ì€?
          **ì •ë‹µ:** í•´ë‹¹ ì½”ë“œ ë¸”ë¡ì„ **ì„ê³„ ì˜ì—­(Critical Section)**ìœ¼ë¡œ ì„¤ì •í•˜ê³ , ì„¸ë§ˆí¬ì–´ë‚˜ ë®¤í…ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì›ìì„±(Atomicity)**ì„ ë³´ì¥í•´ì•¼ í•œë‹¤.

          ### Q2. êµì°©ìƒíƒœ(Deadlock)ì™€ì˜ ê´€ê³„
          **ë¬¸ì œ:** ì„¸ë§ˆí¬ì–´ë¥¼ ì˜ëª» ì‚¬ìš©í•˜ì—¬ ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ì„œë¡œì˜ ìì› í•´ì œë¥¼ ë¬´í•œíˆ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœëŠ”?
          **ì •ë‹µ:** êµì°©ìƒíƒœ (Deadlock)

          ### Q3. P/V ì—°ì‚°ì˜ ì˜ë¯¸
          **ë¬¸ì œ:** ì¹´ìš´íŒ… ì„¸ë§ˆí¬ì–´ì˜ ì´ˆê¸°ê°’ì´ 3ì¼ ë•Œ, 5ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— Pì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©´ ëª‡ ê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ëŒ€ê¸° ìƒíƒœê°€ ë˜ëŠ”ê°€?
          **ì •ë‹µ:** 2ê°œ
          > **í’€ì´:** ìì›(3ê°œ) - ìš”ì²­(5ê°œ) = -2. ìŒìˆ˜ê°’ì´ë¯€ë¡œ 2ê°œì˜ í”„ë¡œì„¸ìŠ¤ëŠ” ìì›ì„ ì–»ì§€ ëª»í•˜ê³  Block ëœë‹¤.

          ---
          > *Auto-generated by GitHub Actions*
          EOF
          
          echo "âœ… ì„¸ë§ˆí¬ì–´ ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ: $FILE_NAME"

      - name: Commit and Push
        run: |
          git config --global user.name "study-bot"
          git config --global user.email "study-bot@noreply.github.com"
          
          git add reports/
          
          if git diff --staged --quiet; then
            echo "ë³€ê²½ ì‚¬í•­ ì—†ìŒ."
          else
            git commit -m "Add Semaphore Study Report (${TODAY})"
            git push
          fi
